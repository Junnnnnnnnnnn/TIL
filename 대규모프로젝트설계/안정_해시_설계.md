# 안정 해시 설계

> 수평적 규모 확장성을 위해 해시 기술을 사용하는데 이는 요청 또는 데이터를 서버에 균등하게 나누기 위해 사용된다

## 수평적 캐시 서버
캐시 서버에 데이터를 주로 저장할 때 키 - 값 형식으로 저장하게 되는데 이때 서버가 수평적으로 증설되었을 땐 인덱스 값을 같이 넣는다 

| 키  | 해시값    | 인덱스 |
| --- | --------- | ------ |
| k0  | 39748529  | 0      |
| k4  | 345773457 | 4      |
| k15  | 34573457  | 2      |
| k2  | 3473457   | 2      |
| k3  | 34834     | 1      |
| k1  | 723747243 | 0      |


해당 테이블은 해시 테이블인데 수평적으로 분포되어 있는 캐시 서버중 가지고 있는 키 데이터를 찾기 위해서 해시값을 같이 저장해 두는데 이때 서버의 인덱스 값을 알기 위해선 %(모듈러) 4(서버 갯수) 를 통해 알수 있게 된다

`하지만` 문제점이 생기는데 만약 서버 한대가 죽었을 때에 위 해시 테이블을 사용한다면 클라이언트에게 잘못된 값을 줄 수 있고 값 저장도 좋지 않은 방법으로 될 것이다.

## 안정해시
> 고정 되어 있는 해시 테이블 대신 고안된 방법

`안정해시` 는 SHA-256 길이 만큼의 리스트를 만들고 처음과 끝은 연결시킨 형태의 해시 이다.<br>
안정해시에 서버의 인덱스를 각각 원하는 위치에 저장 시켜주고 키 값도 동일하게 저장 시켜 준다. 여기서 키값이 저장되어 있는 서버 인덱스를 찾기 위해선 % 를 사용하는 것이 아닌 단순하게 키 값 다음 값으로 오는 값을 서버 값이라고 생각하면 된다.