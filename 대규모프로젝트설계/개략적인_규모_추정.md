# 개략적인 규모 추정
> 보편적으로 통용되는 성능 수치상에서 사고 실험을 행하여 추정치를 계산하는 행위
>
> 어떤 설계가 요구사항에 부합할 것인지 보기위한 것

## 규모 확장성을 표현하는 데 필요한 기본기
> `2의 제곱수`나 `응답지연 값` 그리고 가용성에 관계된 수치들을 기본적으로 잘 이해하고 있어야 한다

### 2의 제곱수
> 데이터양의 제대로 된 계산 결과를 얻으려면 데이터 볼륨의 담위를 2의 제곱수로 표현하면 어떻게 되는지 우선 알아야 한다

- 2의 10 제곱 = 1KB
- 2의 20 제곱 = 1MB
- 2의 30 제곱 = 1GB
- 2의 40 제곱 = 1TB
- 2의 50 제곱 = 1PB

### 응답 지연 값
> 네트워크가 아무리 빨라졌다고 해도 컴퓨터 연산속도를 짐작할 수 있어야 한다

| 연산명                                              | 시간      |
| --------------------------------------------------- | --------- |
| L1 캐시 참조                                        | 0.5ns     |
| 분기 예측 오류                                      | 5ns       |
| L2 캐시 참조                                        | 7ns       |
| 뮤텍스 락/언락                                      | 100ns     |
| 주 메모리 참조                                      | 100ns     |
| Zippy로 1KB 참조                                    | 10,000ns  |
| 1 Gbps 네트워크로 2KB 전송                          | 20,0000ns |
| 메모리에서 1 MB 순차적으로 read                     | 250,000ns |
| 같은 데이터 센터 내에서의 메시지 왕복 지연시간      | 500,000ns |
| 디스크 탐색                                         | 10ms      |
| 네트워크에서 1MB 순차적으로 read                    | 10ms      |
| 디스크에서 1MB 순차적으로 read                      | 30ms      |
| 한 패킷의 캘리포니아로부터 네덜란드까지의 왕복 시간 | 150ms     |

---

위 내용으로 알게된 사실은

- 메모리는 빠르지만 `디스크는 아직 느리다`
- `디스크 탐색(seek)`는 가능한 한 피해라
- `단순한 압축` 알고리즘은 빠르다
- 데이터를 인터넷으로 전송하기 전에 가능하면 `압축` 하라
- 데이터 센터는 보통 여러지역에 분산되어 있고 센터들 간에 데이터를 주고받는데 시간이 `걸린다`

### 가용성에 관계된 수치들
> 고가용성 이라 함은 시스템을 오랜 시간 동안 지속적으로 중단없이 운영될 수 있는 능력을 의미함
>
> 이떄 고가용성 `100%`라고 함은 시스템이 운영중에 있어 한번도 중단된 적이 없었음을 의미한다

## 예제: 트위터 QPS와 저장소 요구량 추정
**가정**

- 월간 능동 사용자는 약 3억명
- 50%는 매일 사용
- 평균적으로 유저는 2건의 트윗을 올림
- 미디어를 포함하는 트윗은 10%
- 데이터는 5년간 보관
  
**추정**

- QPS(Query per second) 추정치
  - 일간 능동 사용자는 3억 X 50% = 1.5억
  - QPS = 1.5억 X 2트윗 / 24시간 /3600초 = 약 3500건 (1초당 3500건 트윗)
  - 최대 QPS = 2 X QPS 약 7000건
- 미디어 저장을 위한 저장소 요구량
  - 평균 트윗 크기
    - tweet_id: 64 바이트
    - 텍스트에 140 바이트
    - 미디어 1MB 바이트
  - 미디어 저장소 요구량: 1.5억 X 2 X 10% X 1MB = 30TB / 일
  
> 팁
> - 계산을 할 때엔 0 단위로 떨어지겠금 하라
> - 가정을 적어두어 추정을 설명하라
> - 단위를 붙혀라 `tweet_id` 데이터 크기를 64 라고만 하면 햇깔린다
> - 개략적 추정 문제는 `QPS` 저장소 요구량 캐시 요구량 서버 수 등을 추정하라는 것이다